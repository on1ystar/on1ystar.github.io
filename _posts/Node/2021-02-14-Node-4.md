---
layout: post
title: Node.js/Express ë¯¸ë“¤ì›¨ì–´
date: 2021-04-24 +0900
categories: [Node.js]
sitemap:
  changefreq: daily
  priority: 1.0
---

---

<div class="intro" >

ì˜ë¬¸ì ì´ë‚˜ ì§€ì  ë“±ì˜ ê´€ì‹¬ ë° ì¡°ì–¸ì„ ìœ„í•œ ëŒ“ê¸€ì´ë‚˜ ë©”ì¼ì€ ì–¸ì œë‚˜ í™˜ì˜ì´ê³  ê°ì‚¬í•©ë‹ˆë‹¤.

</div>

<br>
<div class="t-t-c text-shadow-blue"><h2>â˜„ About middleware</h2></div>
<br>

`ë¯¸ë“¤ì›¨ì–´(middleware)`ëŠ” ìš”ì²­ê³¼ ì‘ë‹µì˜ ì¤‘ê°„ì— ìœ„ì¹˜í•´ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê±°ë‚˜, ì›ì¹˜ ì•ŠëŠ” ìš”ì²­ì„ ê±¸ëŸ¬ë‚´ëŠ” ë“± ë§¤ìš° ë‹¤ì–‘í•˜ë‹¤. ë¼ìš°í„°ë‚˜ ì—ëŸ¬ í•¸ë“¤ëŸ¬ ë˜í•œ ë¯¸ë“¤ì›¨ì–´ì˜ ì¼ì¢…ì´ë‹¤. ì‚¬ì‹¤ í•¸ë“¤ëŸ¬ë“¤ ì¤‘ ë¯¸ë“¤ì›¨ì–´ì™€ ì»¨íŠ¸ë¡¤ëŸ¬ ë“±ì„ êµ¬ë¶„í•˜ëŠ” ê¸°ì¤€ì€ ë¬¸ë²•ì ì¸ ê²ƒ ë³´ë‹¤ëŠ” ì˜ë¯¸ì ì¸ ê²ƒì´ í¬ë‹¤.

```jsx
const handleHome = (req, res) =>
  res.send("This is the first home for Express.");

app.get("/", handleHome);

app.listen(PORT, () =>
  console.log(`âœ… Server listening on http://127.0.0.1:${PORT}/`)
);
```

ì˜ˆë¥¼ ë“¤ì–´ ìœ„ `handleHome`ì€ `'/'` **ê²½ë¡œë¡œ ì˜¤ëŠ” ìš”ì²­ì„ ë°›ì•„ ì‘ë‹µí•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬**ë‹¤. ë‹¨, ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ë¯¸ë“¤ì›¨ì–´ê°€ ë  ìˆ˜ ìˆë‹¤. ë¯¸ë“¤ì›¨ì–´ë¡œ ì‚¬ìš©í•˜ëŠ” í•¨ìˆ˜ëŠ” ë§¤ê°œë³€ìˆ˜ë¥¼ `req`, `res` ì™¸ì— 3ë²ˆì§¸ë¡œ `next`ë¥¼ ê°€ì§„ë‹¤. (ì²« ë§¤ê°œë³€ìˆ˜ë¡œ `err`ì„ ì¶”ê°€í•˜ë©´ ì—ëŸ¬ ì²˜ë¦¬ ë¯¸ë“¤ì›¨ì–´ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ. ê·¸ë¦¬ê³  **ì´ ë³€ìˆ˜ë“¤ì˜ ë³€ìˆ˜ ëª…ì€ ì „í˜€ ìƒê´€ì´ ì—†ê³  ìˆœì„œê°€ ì¤‘ìš”í•¨**.)

```jsx
const logger = (req, res, next) => {
  console.log(`${req.method} ${req.url}.`);
  next();
};
const handleHome = (req, res) =>
  res.send("This is the first home for Express.");

app.get("/", logger, handleHome);
```

- `req.method` : ìš”ì²­ëœ http mothod
- `req.url` : ìš”ì²­ëœ url

ë¯¸ë“¤ì›¨ì–´ë¥¼ ì½œë°±ìœ¼ë¡œ ë“±ë¡í•˜ëŠ” ë°©ë²•ì€ `get`ì˜ **ë‘ ë²ˆì§¸ ì¸ìë¶€í„°** ì°¨ë¡€ëŒ€ë¡œ ì…ë ¥í•´ ì£¼ë©´ ëœë‹¤. ì‚¬ì‹¤ `Application.get()` ë©”ì†Œë“œëŠ” ì¸ì ê°’ìœ¼ë¡œ ì—¬ëŸ¬ ê°œì˜ í•¸ë“¤ëŸ¬ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆë‹¤.

<img src="{{'/public/img/node/node-4-1.png'}}">

ê·¸ëŸ¼ ì—¬ëŸ¬ ê°œì˜ í•¸ë“¤ëŸ¬ë¥¼ ì•Œì•„ì„œ `get` í•¨ìˆ˜ê°€ ì‹¤í–‰ì‹œì¼œ ì£¼ëŠ”ê°€? ì™„ì „íˆ ê·¸ë ‡ì§€ëŠ” ì•Šë‹¤. ë¨¼ì € ê°€ì¥ ì²« ë²ˆì§¸ í•¸ë“¤ëŸ¬(ë‘ ë²ˆì§¸ ì¸ì ê°’)ë¥¼ ì½œë°±ìœ¼ë¡œ í˜¸ì¶œì‹œí‚¨ë‹¤. ê·¸ëŸ¼ í˜¸ì¶œëœ í•¸ë“¤ëŸ¬ì—ì„œ ì—¬ëŸ¬ ë¡œì§ì„ ì²˜ë¦¬í•œ ë‹¤ìŒ ë‘ ë²ˆì§¸ í•¸ë“¤ëŸ¬(ìœ„ ì—ì„œëŠ” `handleHome` ì»¨íŠ¸ë¡¤ëŸ¬)ë¥¼ í˜¸ì¶œí•˜ê¸° ìœ„í•´ì„œëŠ” ë¯¸ë“¤ì›¨ì–´ì˜ 3ë²ˆ ì§¸ ì¸ìˆ˜ì¸ `next`ë¥¼ ì‚¬ìš©í•´ `next()`ì™€ ê°™ì´ í˜¸ì¶œí•œë‹¤.

ì¤‘ìš”í•œ ê²ƒì€ ìˆœì„œë‹¤. ê° ë¯¸ë“¤ì›¨ì–´ì˜ ëª©ì ì— ë§ê²Œ **ìš”ì²­ì„ ë°›ì•„ ì‘ë‹µ ì²˜ë¦¬ë¥¼ í•˜ëŠ” í•¸ë“¤ëŸ¬(ì»¨íŠ¸ë¡¤ëŸ¬) ì „ì— í˜¸ì¶œ**ë˜ì•¼ í•˜ë¯€ë¡œ ê·¸ ì•ì— ë„£ì–´ì¤€ë‹¤. ë‹¨, ë¯¸ë“¤ì›¨ì–´ê°€ ëª©ì  ìƒ ë¡œì§ì„ ì²˜ë¦¬í•œ ë‹¤ìŒ ì‘ë‹µê¹Œì§€ í•˜ê¸°ë„ í•œë‹¤.

ìœ„ ì˜ˆì œì—ì„œëŠ” `/`ë¡œ ì ‘ì†í•˜ë©´, `get` â†’ `logger`â†’ `handleHome` ìˆœì„œë¡œ ì²˜ë¦¬ëœë‹¤.

`handleHome` ì»¨íŠ¸ë¡¤ëŸ¬ì— `next`ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆì§€ë§Œ ì—­í•  ìƒ ë§ˆì§€ë§‰ì— í˜¸ì¶œë˜ê¸° ë•Œë¬¸ì— í•„ìš” ì—†ë‹¤.

ë¯¸ë“¤ì›¨ì–´ëŠ” ë³´í†µ global ì˜ì—­ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ `app.use()`ì™€ í•¨ê»˜ ì‚¬ìš©ëœë‹¤.

ë‹¤ì‹œ í•œ ë²ˆ ê°•ì¡°í•˜ìë©´ ì´ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ìˆœì„œê°€ ë§¤ìš° ì¤‘ìš”í•˜ë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ìœ„ì—ì„œ ì•„ë˜ë¡œ í•œ ì¤„ì”© ì‹¤í–‰ë˜ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ íŠ¹ì„±ì„ ê·¸ëŒ€ë¡œ ì´ì–´ ë°›ì•„ `app.use()`ê°€ ì„ ì–¸ëœ ìœ„ì¹˜ì— ë”°ë¼ ì‹¤í–‰ ë˜ê³ , ì•ˆë˜ê³ ê°€ ê²°ì •ë  ìˆ˜ ìˆë‹¤.

```jsx
app.use((req, res, next) => {
  console.log("global middleware");
  next();
});

app.get("/", (req, res) => res.send("Home")); // global middleware ë¡œê·¸ê°€ ì°í˜
app.get("/login", (req, res) => res.send("Login")); // global middleware ë¡œê·¸ê°€ ì°í˜
```

```jsx
app.get("/", (req, res) => res.send("Home")); // global middleware ë¡œê·¸ê°€ ì•ˆ ì°í˜
app.use((req, res, next) => {
  console.log("global middleware");
  next();
});
app.get("/login", (req, res) => res.send("Login")); // global middleware ë¡œê·¸ê°€ ì°í˜
```

íŠ¹ì • url ìš”ì²­ì—ë§Œ ì‹¤í–‰ë˜ëŠ” ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ìœ¼ë©´ ì²« ë²ˆì§¸ ì¸ìì— urlì„ ì§€ì •í•´ ì£¼ë©´ ëœë‹¤.

```jsx
app.use("/", (req, res, next) => {
  console.log("global middleware");
  next();
});

app.get("/", (req, res) => res.send("Home")); // global middleware ë¡œê·¸ê°€ ì°í˜
app.get("/login", (req, res) => res.send("Login")); // global middleware ë¡œê·¸ê°€ ì•ˆ ì°í˜
```

ì—¬ê¸°ì„œ ì£¼ì˜í•´ì•¼ í•  ì ì€ `next()`ë¥¼ í•´ì£¼ì§€ ì•Šìœ¼ë©´ ë‹¤ìŒ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì‘ë‹µì„ ë³´ë‚´ì§€ ëª»í•´ ì¼ì¢…ì˜ block ìƒíƒœê°€ ëœë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ìœ„ ì½”ë“œì—ì„œ `next()`ë¥¼ ìƒëµí•˜ë©´ `/`ìš”ì²­ì— `res.send("Home")`ì‘ë‹µì„ ë³´ë‚´ì§€ ëª»í•´ ë¹ˆ í™”ë©´ì—ì„œ ë¡œë”© ì¤‘ì´ ë°˜ë³µëœë‹¤.

ì´ë¥¼ í™œìš©í•´ ê°„ë‹¨í•˜ê²Œ ë¡œê¹…ì„ í™•ì¸í•  `logger`ì™€ íŠ¹ì • url ì ‘ì†ì„ ì°¨ë‹¨í•˜ëŠ” `privateMiddleware`ë¥¼ ë§Œë“¤ì–´ ë³¼ ìˆ˜ ìˆë‹¤.

```jsx
const logger = (req, res, next) => {
  console.log(`${req.method} ${req.url}.`);
  next();
};
const privateMiddleware = (req, res, next) => {
  const url = req.url;
  if (url === "/protected") {
    console.log("ğŸš¨ Someone tried to connect to private lounge.");
    res.send("<h1>Not Allowed</h1>");
  }
  next();
};

const handleHome = (req, res) =>
  res.send("This is the first home for Express.");
const handleProtected = (req, res) =>
  res.send("Welcome to the private lounge.");

app.use(logger);
app.use("protected", privateMiddleware);
app.get("/", handleHome);
app.get("protected", handleProtected);
```

- `/`ë¡œ ì ‘ì† ì‹œë„ ì‹œ,

<img src="{{'/public/img/node/node-4-2.png'}}">

`logger` â†’ `handlehome`

- `/protected`ë¡œ ì ‘ì† ì‹œë„ ì‹œ,

<img src="{{'/public/img/node/node-4-3.png'}}">

`logger` â†’ `privateMiddleware` (`handleProtected`ëŠ” í˜¸ì¶œë˜ì§€ ì•ŠìŒ)

<br>
<div class="t-t-c text-shadow-blue"><h2>â˜„ ìì£¼ ì‚¬ìš©í•˜ëŠ” ë¯¸ë“¤ì›¨ì–´</h2></div>
<br>

npmì—ëŠ” í›Œë¥­í•œ ë¯¸ë“¤ì›¨ì–´ë“¤ì´ ë§ê¸° ë•Œë¬¸ì— ì ê·¹ì ìœ¼ë¡œ ì´ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

### morgan

node.jsìš© **HTTP ìš”ì²­ ë¡œê±° ë¯¸ë“¤ì›¨ì–´**ë¡œ ìœ„ì—ì„œ ë§Œë“  `logger`ë³´ë‹¤ ë‹¤ì–‘í•˜ê³  ì •êµí•œ ê¸°ëŠ¥ë“¤ì„ ê°€ì§€ê³  ìˆì–´ ë¡œê¹…ì„ ìœ„í•œ ë¯¸ë“¤ì›¨ì–´ë¡œ ë§ì´ ì‚¬ìš©ëœë‹¤.

ë‹¤ì–‘í•œ ì˜µì…˜ì´ ìˆìœ¼ë¯€ë¡œ ë¬¸ì„œì—ì„œ ì°¸ê³ 

[http://expressjs.com/en/resources/middleware/morgan.html](http://expressjs.com/en/resources/middleware/morgan.html)

- `npm install morgan`

```jsx
// ...
import morgan from "morgan";

// ...

const logger = morgan("dev"); // 5ê°€ì§€ ì˜µì…˜ ì¤‘ dev ì‚¬ìš©

const handleHome = (req, res) =>
  res.send("This is the first home for Express.");

app.use(logger);
app.get("/", handleHome);

// ...
```

<img src="{{'/public/img/node/node-4-4.png'}}">

ìˆœì„œëŒ€ë¡œ **HTTP method**, **route**, **status code**, **ì‘ë‹µì‹œê°„**

ì´ ì™¸ì—ë„ ì•ìœ¼ë¡œ ì‚¬ìš©í•  ë¯¸ë“¤ì›¨ì–´ë“¤ì„ ê°„ë‹¨íˆ ì†Œê°œë§Œ í•´ ë³´ë©´,

### body-parser

`body` ìš”ì²­ì˜ êµ¬ë¬¸ ë¶„ì„, íŠ¹íˆ ì‚¬ìš©ìì˜ ì…ë ¥ íŒŒì‹±ì— ë„ì›€ì„ ì¤Œ.

[http://expressjs.com/en/resources/middleware/body-parser.html](http://expressjs.com/en/resources/middleware/body-parser.html)

- `npm install body-parser`

### Cookie-parser

ì¿ í‚¤ í—¤ë”ë¥¼ êµ¬ë¬¸ ë¶„ì„í•˜ê³  ì¿ í‚¤ ì´ë¦„ìœ¼ë¡œ í‚¤ ì§€ì •ëœ ê°œì²´ë¡œ req.cookieë¥¼ ì±„ì›€

[http://expressjs.com/en/resources/middleware/cookie-parser.html](http://expressjs.com/en/resources/middleware/cookie-parser.html)

- `npm install cookie-parser`

### helmet

ë‹¤ì–‘í•œ ë³´ì•ˆ ê´€ë ¨ ë¯¸ë“¤ì›¨ì–´

[https://www.npmjs.com/package/helmet](https://www.npmjs.com/package/helmet)

- `npm install helmet`

<br>

### Reference

Node.js êµê³¼ì„œ(2íŒ) - ì¡°í˜„ì˜

[https://nomadcoders.co/wetube](https://nomadcoders.co/wetube)
